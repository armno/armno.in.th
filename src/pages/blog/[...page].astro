---
import { getCollection } from 'astro:content';
import PageLayout from '@layouts/PageLayout.astro';
import PostItem from '@components/PostItem.astro';
import WarningMessage from '@components/WarningMessage.astro';
import Pagination from '@components/Pagination.astro';

export async function getStaticPaths({ paginate }) {
  const allPosts = await getCollection('blog');
  const sortedPosts = allPosts.sort((a, b) => {
    return new Date(b.data.pubDate) - new Date(a.data.pubDate);
  });
  return paginate(sortedPosts, { pageSize: 10});
}

const { page } = Astro.props;
const content = {
  title: 'blog',
  description: 'Blog',
  thumbnail: '',
  language: 'en'
}
---

<PageLayout frontmatter={content}>
  <WarningMessage>
    <p>
      Blog listing page is still a work-in-progress.
    </p>
  </WarningMessage>


  <div class="flex items-baseline mb-8 container mx-auto px-6 md:px-0 mt-6">
    <h1 class="text-5xl font-bold mb-0">Blog</h1>
    <span class="text-2xl text-slate-300 mx-4">/</span>
    <span class="text-2xl text-slate-300">Page {page.currentPage} of {page.lastPage} </span>
  </div>

  <ol
    class="list-none px-6 md:p-0 not-prose grid container mx-auto grid-cols-[repeat(auto-fit,minmax(300px,1fr))] gap-x-12 gap-y-12 lg:gap-x-16 lg:gap-y-16"
  >
    {
      page.data.map((post, index) => (
        <li>
          <PostItem
            title={post.data.title}
            url={'/blog/' + post.slug}
            thumbnail={post.data.thumbnail}
            pubDate={post.data.pubDate}
            description={post.data.description}
            isLatest={index === 0}
          />
          <hr class="w-1/2 mx-auto mt-12">
        </li>
      ))
    }
  </ol>

  <Pagination next={page.url.next} prev={page.url.prev} currentPage={page.currentPage} lastPage={page.lastPage} />
</PageLayout>
