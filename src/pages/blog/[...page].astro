---
import PageLayout from "@layouts/PageLayout.astro";
import Pagination from "@components/Pagination.astro";
import PostItem from "@components/PostItem.astro";
import { Frontmatter } from "@shared/frontmatter.interface";
import { sortBy } from "lodash-es";

export async function getStaticPaths({ paginate, rss }) {
  let allPosts = await Astro.glob<Frontmatter>("./**/*.mdx");
  allPosts = sortBy(allPosts, ["frontmatter.pubDate"]).reverse();
  return paginate(allPosts, { pageSize: 12 });
}

const { page } = Astro.props;
const content = {
  title: "Blog - armno.in.th",
};
---

<PageLayout {content} notProse={true}>
  <div class="flex items-baseline mb-8 container mx-auto px-6 md:px-0">
    <h1 class="text-5xl font-bold">Blog</h1>
    <span class="text-2xl text-slate-300 mx-4">/</span>
    <span class="text-2xl text-slate-300"
      >Page {page.currentPage} of {page.lastPage}
    </span>
  </div>

  <ol
    class="list-none px-6 md:p-0 not-prose grid container mx-auto grid-cols-[repeat(auto-fit,minmax(300px,1fr))] gap-x-12 gap-y-16 lg:gap-x-16 lg:gap-y-24"
  >
    {
      page.data.map((post) => (
        <li class="text-3xl">
          <PostItem
            title={post.frontmatter.title}
            url={post.url}
            thumbnail={post.frontmatter.thumbnail}
            pubDate={post.frontmatter.pubDate}
            description={post.frontmatter.description}
          />
        </li>
      ))
    }
  </ol>

  <Pagination next={page.url.next} prev={page.url.prev} />
</PageLayout>
